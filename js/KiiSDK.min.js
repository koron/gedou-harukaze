!function(){var t=function(){var t,e,i,n,s,r=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,u=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a=this;return i="undefined"!=typeof exports&&null!==exports?new Object:this,i.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2},i.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api"},i.Kii=function(){function e(){}var s;return s=null,e.getBuildNumber=function(){return"1"},e.getSDKVersion=function(){return"2.1.11"},e.getBaseURL=function(){return s._baseURL},e.getAppID=function(){return s._appID},e.getAppKey=function(){return s._appKey},e.isLogging=function(){return s._logging},e.setLogging=function(t){return i.Kii.logger("Setting logging: "+t),s._logging=t},e.initializeWithSite=function(t,e,r){return null==s&&(s=new n(t,e,r)),i.Kii.logger("Initialized "+t+", "+e+", "+r)},e.initialize=function(t,e){return i.Kii.initializeWithSite(t,e,i.KiiSite.US)},e.error=function(t){return console.log("KiiSDK Error => "+t)},e.logger=function(t){return s._logging?console.log(t):void 0},e.bucketWithName=function(t){return new i.KiiBucket._bucketWithName(t,null)},e.groupWithName=function(t){return new i.Kii.groupWithNameAndMembers(t,null)},e.groupWithNameAndMembers=function(t,e){return new i.KiiGroup.groupWithNameAndMembers(t,e)},e.logOut=function(){return s._currentUser=null,i.KiiSocialConnect.logOutAll()},e.loggedIn=function(){return null!=s._currentUser},e.getCurrentUser=function(){var t;return null!=s._currentUser?(t=new i.KiiUser,t._uuid=s._currentUser._uuid,t._username=s._currentUser._username,t._displayName=s._currentUser._displayName,t._password=s._currentUser._password,t._emailAddress=s._currentUser._emailAddress,t._phoneNumber=s._currentUser._phoneNumber,t._country=s._currentUser._country,t._created=s._currentUser._created,t._modified=s._currentUser._modified,t._emailVerified=s._currentUser._emailVerified,t._phoneVerified=s._currentUser._phoneVerified,t._accessToken=s._currentUser._accessToken,t._customInfo=s._currentUser._customInfo,i.Kii.logger("my instance:"),i.Kii.logger(t),t):null},e.setCurrentUser=function(t){return s._currentUser=new i.KiiUser,s._currentUser._uuid=t._uuid,s._currentUser._username=t._username,s._currentUser._displayName=t._displayName,s._currentUser._password=t._password,s._currentUser._emailAddress=t._emailAddress,s._currentUser._phoneNumber=t._phoneNumber,s._currentUser._country=t._country,s._currentUser._created=t._created,s._currentUser._modified=t._modified,s._currentUser._emailVerified=t._emailVerified,s._currentUser._phoneVerified=t._phoneVerified,s._currentUser._accessToken=t._accessToken,s._currentUser._customInfo=t._customInfo,i.Kii.logger("my instance:"),i.Kii.logger(s._currentUser)},e.authenticateAsAppAdmin=function(e,n,s){var r,o;return o=new t("/oauth2/token",!1),o.setAnonymous(!0),o.setMethod("POST"),o.setData({client_id:e,client_secret:n}),r={success:function(t){var e,n,r;return r=t.access_token,n=t.id,i.Kii.logger("token: "+r),i.Kii.logger("id: "+n),e=new i.KiiAppAdminContext({token:r,id:n}),null!=s?s.success(e):void 0},failure:function(t,e){return i.Kii.logger("error: "+t),i.Kii.logger("statusCode: "+e),null!=s?s.failure(t,e):void 0}},o.execute(r,!1)},e}(),n=function(){function t(t,e,i){console.log("Setting site: "+i),this._appKey=e,this._appID=t,this._baseURL=i}return t.prototype._logging=!1,t.prototype._baseURL=null,t.prototype._currentUser=null,t}(),i.KiiACL=function(){function n(){this._userWithID=r(this._userWithID,this),this._groupWithID=r(this._groupWithID,this),this._getRequest=r(this._getRequest,this),this._saveItr=r(this._saveItr,this),this.save=r(this.save,this),this.removeACLEntry=r(this.removeACLEntry,this),this.putACLEntry=r(this.putACLEntry,this),this.listACLEntries=r(this.listACLEntries,this),this.aclPath=r(this.aclPath,this),this._setParent=r(this._setParent,this),this._entries=[]}var s,o,u;return u=null,s=null,o=null,n.prototype._setParent=function(t){this._parent=t},n.prototype.aclPath=function(){var t,e,n,s,r,o,u;return this._parent instanceof i.KiiObject?(s=this._parent,null!=s.getBucket().getUser()?u=s.getBucket().getUser():null!=s.getBucket().getGroup()&&(n=s.getBucket().getGroup()),e=s.getBucket().getBucketName(),r=s.getUUID()):this._parent instanceof i.KiiBucket?(t=this._parent,null!=t.getUser()?u=t.getUser():null!=t.getGroup()&&(n=t.getGroup()),e=t.getBucketName()):i.Kii.error("Invalid ACL parent. Must belong to a KiiObject"),o="/",null!=n?o+="groups/"+n.getUUID()+"/":null!=u&&(o+="users/"+u.getUUID()+"/"),o+=null!=r?"buckets/"+e+"/objects/"+r+"/acl":"buckets/"+e+"/acl"},n.prototype.listACLEntries=function(t){var e,n,s=this;return u=this,i.Kii.logger("Listing ACL entries"),n=this._getRequest({path:this.aclPath(),withApp:!0}),e={success:function(e,n){var r,o,a,h,c,l,_,p;if(300>n&&n>=200){h=[];for(a in e)for(l=e[a],"WRITE_EXISTING_OBJECT"===a?r=i.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===a?r=i.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===a?r=i.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===a?r=i.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===a&&(r=i.KiiACLAction.KiiACLBucketActionDropBucket),_=0,p=l.length;p>_;_++)o=l[_],null!=o.groupID?c=s._groupWithID(o.groupID):null!=o.userID&&(c=s._userWithID(o.userID)),h.push(KiiACLEntry.entryWithSubject(c,r));return t.success(u,h)}return t.failure(u,"Unable to retrieve ACL list")},failure:function(e){return t.failure(u,e)}},n.execute(e,!1)},n.prototype.putACLEntry=function(t){return-1===$.inArray(t,this._entries)?this._entries.push(t):void 0},n.prototype.removeACLEntry=function(t){var i;return i=$.inArray(t,this._entries),i>-1?e.arrayRemove(this._entries,i,i):void 0},n.prototype.save=function(t){return i.Kii.logger("SAving acl"),this._saveItr(0,t)},n.prototype._saveItr=function(t,e){var n,s,r,o,u=this;return u=this,n=this._entries[t],s=""+this.aclPath()+"/"+n.getActionString()+"/"+n.getEntityString(),i.Kii.logger("Saving single @path: "+s),r=this._getRequest({path:s,withApp:!0}),r.setMethod(n.getGrant()===!0?"PUT":"DELETE"),o=null,r.execute({success:function(){return t<u._entries.length-1?u._saveItr(t+1,e):e.success(u)},failure:function(t){return e.failure(u,t)}},!1)},n.aclWithParent=function(t){var e;return e=new i.KiiACL,e._setParent(t),e},n.prototype._getRequest=function(e){var i,n,s;return i=e.path,s=e.withApp,n=new t(i,s)},n.prototype._groupWithID=function(t){var e;return e=i.KiiGroup._groupWithID(t)},n.prototype._userWithID=function(t){var e;return e=i.KiiUser._userWithID(t)},n}.call(this),i.KiiACLAction={KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4},i.KiiACLEntry=function(){function t(){this.getEntityString=r(this.getEntityString,this),this.getActionString=r(this.getActionString,this),this.getGrant=r(this.getGrant,this),this.setGrant=r(this.setGrant,this),this.getSubject=r(this.getSubject,this),this.setSubject=r(this.setSubject,this),this.getAction=r(this.getAction,this),this.setAction=r(this.setAction,this),this._action=-1,this._grant=!0}var e,n,s;return e=null,s=null,n=null,t.prototype.setAction=function(t){if(t>=i.KiiACLAction.KiiACLBucketActionCreateObjects&&t<=i.KiiACLAction.KiiACLObjectActionWrite)return this._action=t;throw new InvalidACLAction},t.prototype.getAction=function(){return this._action},t.prototype.setSubject=function(t){if(t instanceof i.KiiGroup||t instanceof i.KiiUser||t instanceof i.KiiAnyAuthenticatedUser||t instanceof i.KiiAnonymousUser)return this._subject=t;throw new InvalidACLSubject},t.prototype.getSubject=function(){return this._subject},t.prototype.setGrant=function(t){if(t===!0||t===!1)return this._grant=t;throw new InvalidACLGrant},t.prototype.getGrant=function(){return this._grant},t.entryWithSubject=function(t,e){var n;return i.Kii.logger("EWS: "+t+", "+e),n=new i.KiiACLEntry,n.setSubject(t),n.setAction(e),n},t.prototype.getActionString=function(){var t;switch(i.Kii.logger("Action: "+this.action),this._action){case i.KiiACLAction.KiiACLBucketActionCreateObjects:t="CREATE_OBJECTS_IN_BUCKET";break;case i.KiiACLAction.KiiACLBucketActionQueryObjects:t="QUERY_OBJECTS_IN_BUCKET";break;case i.KiiACLAction.KiiACLBucketActionDropBucket:t="DROP_BUCKET_WITH_ALL_CONTENT";break;case i.KiiACLAction.KiiACLObjectActionRead:t="READ_EXISTING_OBJECT";break;case i.KiiACLAction.KiiACLObjectActionWrite:t="WRITE_EXISTING_OBJECT";break;default:return t}return t},t.prototype.getEntityString=function(){var t,e;return this._subject instanceof i.KiiGroup?(t=this._subject.getUUID(),e="GroupID"):this._subject instanceof i.KiiUser?(t=this._subject.getUUID(),e="UserID"):this._subject instanceof i.KiiAnyAuthenticatedUser?(e="UserID",t="ANY_AUTHENTICATED_USER"):this._subject instanceof i.KiiAnonymousUser&&(e="UserID",t="ANONYMOUS_USER"),""+e+":"+t},t}.call(this),i.KiiBucket=function(){function e(t,e){this.objectWithJSON=r(this.objectWithJSON,this),this._generatePath=r(this._generatePath,this),this._getRequest=r(this._getRequest,this),this["delete"]=r(this["delete"],this),this.executeQuery=r(this.executeQuery,this),this.acl=r(this.acl,this),this.createObjectWithType=r(this.createObjectWithType,this),this.createObject=r(this.createObject,this),this._setBucketName=r(this._setBucketName,this),this.getBucketName=r(this.getBucketName,this),this._setGroup=r(this._setGroup,this),this.getGroup=r(this.getGroup,this),this._setUser=r(this._setUser,this),this.getUser=r(this.getUser,this),this._bucketName=t,null!=e&&(e instanceof i.KiiGroup?this._group=e:e instanceof i.KiiUser&&(this._user=e))}var n,s,o,u;return e.prototype._className="KiiBucket",o=null,n=null,u=null,s=null,e.prototype.getUser=function(){return this._user},e.prototype._setUser=function(t){this._user=t},e.prototype.getGroup=function(){return this._group},e.prototype._setGroup=function(t){this._group=t},e.prototype.getBucketName=function(){return this._bucketName},e.prototype._setBucketName=function(t){this._bucketName=t},e.prototype.createObject=function(){return i.KiiObject.objectWithBucket(this,null)},e.prototype.createObjectWithType=function(t){return i.KiiObject.objectWithBucket(this,t)},e.prototype.acl=function(){return i.KiiACL.aclWithParent(this)},e.prototype.executeQuery=function(t,e){var n,s,r,u,a;return o=this,u=this._generatePath()+"/query",s={},null!=t?(n=t._dictValue(),s.bestEffortLimit=t.getLimit(),null!=t.getPaginationKey()&&(s.paginationKey=t.getPaginationKey())):n={clause:i.KiiQuery._emptyDictValue()},a=this._getRequest({path:u,withApp:!0}),a.setMethod("POST"),a.setContentType("application/vnd.kii.QueryRequest+json"),s.bucketQuery=n,a.setData(s),r={success:function(i,n){var s,r,u,a,h,c;if(300>n&&n>=200){for(u=[],c=i.results,a=0,h=c.length;h>a;a++)r=c[a],u.push(o.objectWithJSON(r));if(null!=i.nextPaginationKey&&(s=jQuery.extend(!0,{},t),s.setPaginationKey(i.nextPaginationKey)),null!=e)return e.success(t,u,s)}else if(null!=e)return e.failure(t,"Unable to parse response")},failure:function(t){return null!=e?e.failure(o,t):void 0}},a.execute(r,!1)},e.prototype["delete"]=function(t){var e,i;return o=this,i=this._getRequest({path:this._generatePath(),withApp:!0}),i.setMethod("DELETE"),e={success:function(){return null!=t?t.success(o):void 0},failure:function(e){return null!=t?t.failure(o,e):void 0}},i.execute(e,!0)},e._bucketWithName=function(t,e){var n;return n=new i.KiiBucket(t,e)},e.prototype._getRequest=function(e){var i,n,s;return i=e.path,s=e.withApp,n=new t(i,s)},e.prototype._generatePath=function(){var t;return t=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._bucketName:null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._bucketName:"/buckets/"+this._bucketName},e.prototype.objectWithJSON=function(t){var e;return e=this.createObject(),e._updateWithJSON(t),e},e}.call(this),i.KiiBucketAdmin=function(t){function e(t,i,n){this.acl=r(this.acl,this),this.createObjectWithType=r(this.createObjectWithType,this),this.createObject=r(this.createObject,this),this._getRequest=r(this._getRequest,this),e.__super__.constructor.call(this,t,i),this._adminToken=n}var n;return u(e,t),n=null,e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._adminToken),i},e.prototype.createObject=function(){return i.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},e.prototype.createObjectWithType=function(t){return i.KiiObjectAdmin.objectWithBucket(this,t,this._adminToken)},e.prototype.acl=function(){var t;return t=new i.KiiACLAdmin(this,this._adminToken)},e}(i.KiiBucket),i.KiiGroup=function(){function n(){this._setOwnerFromContext=r(this._setOwnerFromContext,this),this._userWithID=r(this._userWithID,this),this._getRequest=r(this._getRequest,this),this.getOwner=r(this.getOwner,this),this["delete"]=r(this["delete"],this),this.refresh=r(this.refresh,this),this.save=r(this.save,this),this.changeGroupName=r(this.changeGroupName,this),this._saveMembers=r(this._saveMembers,this),this.getMemberList=r(this.getMemberList,this),this._removeMember=r(this._removeMember,this),this._addMember=r(this._addMember,this),this.removeUser=r(this.removeUser,this),this.addUser=r(this.addUser,this),this.bucketWithName=r(this.bucketWithName,this),this.objectURI=r(this.objectURI,this),this._setOwner=r(this._setOwner,this),this.getCachedOwner=r(this.getCachedOwner,this),this._setName=r(this._setName,this),this.getName=r(this.getName,this),this._setUUID=r(this._setUUID,this),this.getUUID=r(this.getUUID,this),this._setAddMembers=r(this._setAddMembers,this),this._getRemoveMembers=r(this._getRemoveMembers,this),this._getAddMembers=r(this._getAddMembers,this),this._addMembers=[],this._removeMembers=[]}var s,o,u,a,h;return h=null,o=null,u=null,s=null,a=null,n.prototype._getAddMembers=function(){return this._addMembers},n.prototype._getRemoveMembers=function(){return this._removeMembers},n.prototype._setAddMembers=function(t){var e,i,n,s;if(null!=t){for(s=[],i=0,n=t.length;n>i;i++)e=t[i],s.push(this._addMembers.push(e));return s}},n.prototype.getUUID=function(){return this._uuid},n.prototype._setUUID=function(t){this._uuid=t},n.prototype.getName=function(){return this._groupName},n.prototype._setName=function(t){this._groupName=t},n.prototype.getCachedOwner=function(){return this._owner},n.prototype._setOwner=function(t){this._owner=t},n.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},n.prototype.bucketWithName=function(t){var e;return e=new i.KiiBucket(t,this)},n.prototype.addUser=function(t){var i;return $.inArray(t,-1===this._addMembers)&&this._addMembers.push(t),i=$.inArray(t,this._removeMembers),i>=0?e.arrayRemove(this._removeMembers,i,i):void 0},n.prototype.removeUser=function(t){var i;return $.inArray(t,-1===this._removeMembers)&&this._removeMembers.push(t),i=$.inArray(t,this._addMembers),i>=0?e.arrayRemove(this._addMembers,i,i):void 0},n.prototype._addMember=function(t,n){var s,r;return h=this,i.Kii.logger("Adding member "+t.getUUID()+" to group "+this._groupName),r=this._getRequest({path:"/groups/"+this._uuid+"/members/"+t.getUUID(),withApp:!0}),r.setMethod("PUT"),s={success:function(){var i;return i=$.inArray(t,h._getAddMembers()),e.arrayRemove(h._getAddMembers(),i,i),n.success(h)},failure:function(i){var s;return s=$.inArray(t,h._getAddMembers()),e.arrayRemove(h._getAddMembers(),s,s),n.failure(h,i)}},r.execute(s,!1)},n.prototype._removeMember=function(t,n){var s,r;return h=this,i.Kii.logger("Removing member "+t.getUUID()+" to group "+this._groupName),r=this._getRequest({path:"/groups/"+this._uuid+"/members/"+t.getUUID(),withApp:!0}),r.setMethod("DELETE"),s={success:function(){var i;return i=$.inArray(t,h._getRemoveMembers()),e.arrayRemove(h._getRemoveMembers(),i,i),n.success(h)},failure:function(i){var s;return s=$.inArray(t,h._getRemoveMembers()),e.arrayRemove(h._getRemoveMembers(),s,s),n.failure(h,i)}},r.execute(s,!1)},n.prototype.getMemberList=function(t){var e,n,s=this;return h=this,i.Kii.logger("Getting member list for group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),n.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),e={success:function(e,i){var n,r,o,u,a;if(300>i&&i>=200){for(r=[],o=e.members,u=0,a=o.length;a>u;u++)n=o[u],r.push(s._userWithID(n.userID));if(null!=t)return t.success(h,r)}else if(null!=t)return t.failure(h,n,"Unable to get member list of group")},failure:function(e){return null!=t?t.failure(h,e):void 0}},n.execute(e,!1)},n.prototype._saveMembers=function(t){var e,i,n,s,r,o,u;for(h=this,o=this._removeMembers,i=0,s=o.length;s>i;i++)return e=o[i],this._removeMember(e,t),void 0;for(u=this._addMembers,n=0,r=u.length;r>n;n++)return e=u[n],this._addMember(e,t),void 0;return t.success(h)},n.prototype.changeGroupName=function(t,e){var n,s;return h=this,i.Kii.logger("Saving group: "+this.name),null!=this._uuid?(n=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),n.setContentType("text/plain"),n.setMethod("PUT"),n.setData(t),s={success:function(i,n){if(300>n&&n>=200){if(h._setName(t),null!=e)return e.success(h)}else if(null!=e)return e.failure(h,"Unable to change group name - invalid response")},failure:function(t){return null!=e?e.failure(h,t):void 0}},n.execute(s,!0)):e.failure(h,"Invalid group. Save the group on the server before updating the name.")},n.prototype.save=function(t){var e,n,s;return h=this,i.Kii.logger("Saving group: "+this.name),null==this._uuid?(n=this._getRequest({path:"/groups",withApp:!0}),n.setContentType("application/vnd.kii.GroupCreationRequest+json"),n.setMethod("POST"),e={},null!=this._groupName&&(e.name=this._groupName),this._setOwnerFromContext(e),n.setData(e),s={success:function(e,i){return 300>i&&i>=200?(h._setUUID(e.groupID),h._saveMembers(t)):void 0},failure:function(e){return null!=t?t.failure(h,e):void 0}},n.execute(s,!1)):this._saveMembers(t)},n.prototype.refresh=function(t){var e,n;return h=this,i.Kii.logger("Refreshing group: "+this._groupName),n=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),n.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),e={success:function(e){return h=i.KiiGroup._groupWithJSON(e),null!=t?t.success(h):void 0},failure:function(e){return null!=t?t.failure(h,e):void 0}},n.execute(e,!1)},n.prototype["delete"]=function(t){var e,n;return h=this,i.Kii.logger("Deleting group: "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),n.setMethod("DELETE"),e={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success(h):null!=t?t.failure(h,"Unable to parse response"):void 0},failure:function(e){return null!=t?t.failure(h,e):void 0}},n.execute(e,!0)},n.prototype.getOwner=function(t){return h=this,i.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(e){return null!=t?t.success(e,e.getCachedOwner()):void 0},failure:function(e,i){return null!=t?t.failure(e,i):void 0}})},n.groupWithName=function(t){return i.KiiGroup.groupWithNameAndMembers(t,null)},n.groupWithNameAndMembers=function(t,e){var n;return n=new i.KiiGroup,n._setName(t),n._setAddMembers(e),n},n.groupWithURI=function(t){var e,n,s,r;if(s=null,r=t.substr("kiicloud://".length),n=r.split("/"),e=n.length,!(e>0))throw new i.InvalidURIException;return s=new i.KiiGroup,s._setUUID(n[e-1]),s},n._groupWithID=function(t){var e;return e=new i.KiiGroup,e._setUUID(t),e},n._groupWithJSON=function(t){var e;return e=new i.KiiGroup,null!=t.groupID&&e._setUUID(t.groupID),null!=t.name&&e._setName(t.name),null!=t.owner&&e._setOwner(i.KiiUser._userWithID(t.owner)),e},n.prototype._getRequest=function(e){var i,n,s;return i=e.path,s=e.withApp,n=new t(i,s)},n.prototype._userWithID=function(t){var e;return e=i.KiiUser._userWithID(t)},n.prototype._setOwnerFromContext=function(t){return null!=i.Kii.getCurrentUser()?(this._owner=i.Kii.getCurrentUser(),t.owner=this._owner.getUUID()):void 0},n}.call(this),i.KiiObject=function(){function e(){this.moveBody=r(this.moveBody,this),this._parseObjectUri=r(this._parseObjectUri,this),this._userWithID=r(this._userWithID,this),this._getRequest=r(this._getRequest,this),this["delete"]=r(this["delete"],this),this.refresh=r(this.refresh,this),this.save=r(this.save,this),this.saveAllFields=r(this.saveAllFields,this),this._performSave=r(this._performSave,this),this._updateWithJSON=r(this._updateWithJSON,this),this.objectURI=r(this.objectURI,this),this.objectACL=r(this.objectACL,this),this.getGeoPoint=r(this.getGeoPoint,this),this.setGeoPoint=r(this.setGeoPoint,this),this.get=r(this.get,this),this.set=r(this.set,this),this._getPath=r(this._getPath,this),this._setBucket=r(this._setBucket,this),this.getBucket=r(this.getBucket,this),this._setObjectType=r(this._setObjectType,this),this.getObjectType=r(this.getObjectType,this),this._setModified=r(this._setModified,this),this.getModified=r(this.getModified,this),this._setCreated=r(this._setCreated,this),this.getCreated=r(this.getCreated,this),this._setUUID=r(this._setUUID,this),this.getUUID=r(this.getUUID,this),this._customInfo={}}var n,s,o,u,a,h,c,l;return c=null,e.prototype._alteredFields=[],l=null,s=null,u=null,a=null,o=null,n=null,h=null,e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(t){this._uuid=t},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(t){this._created=t},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(t){this._modified=t},e.prototype.getObjectType=function(){return this._objectType},e.prototype._setObjectType=function(t){this._objectType=t},e.prototype.getBucket=function(){return i.Kii.logger("GEtting bucket "+this._bucket),this._bucket},e.prototype._setBucket=function(t){this._bucket=t},e.prototype._getPath=function(){var t;return t=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket.getBucketName()+"/objects/":"/buckets/"+this._bucket.getBucketName()+"/objects/",null!=this._uuid&&(t+=this._uuid),t},e.prototype.set=function(t,e){return this._customInfo[t]=e,this._alteredFields.push(t)},e.prototype.get=function(t){return this._customInfo[t]},e.prototype.setGeoPoint=function(t,e){if(!(e instanceof KiiGeoPoint))throw InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[t]=e._toDict(),this._alteredFields.push(t)},e.prototype.getGeoPoint=function(t){var e,n,s;return s=this._customInfo[t],e=s.lat,n=s.lon,i.KiiGeoPoint.geoPoint(e,n)},e.prototype.objectACL=function(){return i.KiiACL.aclWithParent(this)},e.prototype.objectURI=function(){var t,e;return t="kiicloud://",null!=this._bucket&&null!=this._uuid&&(e=t,null!=this._bucket.getGroup()?e+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()&&(e+="users/"+this._bucket.getUser().getUUID()+"/"),e+="buckets/"+this._bucket.getBucketName()+"/objects/"+this._uuid),e},e.prototype._updateWithJSON=function(t){var e,n,s;s=[];for(e in t)n=t[e],"objectID"===e||"_id"===e||"uuid"===e?(i.Kii.logger("Setting uuid: "+n),s.push(this._uuid=n)):"createdAt"===e||"_created"===e||"created"===e?s.push(this._created=n):"modifiedAt"===e||"_modified"===e||"modified"===e?s.push(this._modified=n):"_owner"===e?s.push(this._owner=this._userWithID(n)):"_dataType"===e?s.push(this._objectType=n):"_calculated"===e?s.push(this._customInfo[e]=n):"_"!==e[0]?s.push(this._customInfo[e]=n):s.push(void 0);return s},e.prototype._performSave=function(t,e){var n,s,r,o,u,a,h,l;if(c=this,r=this._getPath(),o=new this._getRequest({path:r,withApp:!0}),o.setMethod(null!=this._uuid?"PUT":"POST"),n={},t)n=this._customInfo;else for(l=this._alteredFields,a=0,h=l.length;h>a;a++)s=l[a],n[s]=this._customInfo[s];return o.setData(n),null!=this._objectType&&o.setContentType("application/vnd."+i.Kii.getAppID()+"."+this._objectType+"+json"),null==this._uuid||t||(o.addHeader("X-HTTP-Method-Override","PATCH"),o.setMethod("POST")),u={success:function(t,i){if(300>i&&i>=200){if(c._updateWithJSON(t),c._alteredFields=[],null!=e)return e.success(c)}else if(null!=e)return e.failure(c,"Unable to parse response")},failure:function(t){return null!=e?e.failure(c,t):void 0}},o.execute(u,!1)},e.prototype.saveAllFields=function(t){return this._performSave(!0,t)},e.prototype.save=function(t){return this._performSave(!1,t)},e.prototype.refresh=function(t){var e,i,n;return c=this,e=this._getPath(),n=new this._getRequest({path:e,withApp:!0}),i={success:function(e,i){if(300>i&&i>=200){if(c._updateWithJSON(e),null!=t)return t.success(c)}else if(null!=t)return t.failure(c,"Unable to parse response")},failure:function(e){return null!=t?t.failure(c,e):void 0}},n.execute(i,!1)},e.prototype["delete"]=function(t){var e,i,n;return c=this,e=this._getPath(),n=new this._getRequest({path:e,withApp:!0}),n.setMethod("DELETE"),i={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success(c):null!=t?t.failure(c,"Unable to parse response"):void 0},failure:function(e){return null!=t?t.failure(c,e):void 0}},n.execute(i,!0)},e.objectWithBucket=function(t,e){var n;return i.Kii.logger("Creating object w type: "+e),n=new i.KiiObject,n._setBucket(t),n._setObjectType(e),i.Kii.logger(n),n},e.objectWithURI=function(t){var e,n,s,r,o,u,a,h,c,l;if(a=t.substr("kiicloud://".length),o=a.split("/"),r=o.length,i.Kii.logger(o),!(r>=4))throw new i.InvalidURIException;return n=4===r?1:3,s=o[n],"groups"===o[0]?u=new i.KiiGroup._groupWithID(o[1]):"users"===o[0]&&(l=i.KiiUser._userWithID(o[1])),c=null,null!=u?c=u:null!=l&&(c=l),e=new i.KiiBucket._bucketWithName(s,c),i.Kii.logger(e),h=e.createObject(),h._setUUID(o[r-1]),i.Kii.logger(h),h},e.prototype._getRequest=function(e){var i,n,s;return i=e.path,s=e.withApp,n=new t(i,s)},e.prototype._userWithID=function(t){var e;return e=i.KiiUser._userWithID(t)},e.prototype._parseObjectUri=function(t){var e,n,s,r;return s=t.replace(/^kiicloud:\/\//g,"").split("/"),r=s[0],"users"===r?(n={appID:i.Kii.getAppID(),userID:s[1],type:"APP_AND_USER"},e={targetObjectScope:n,targetBucketID:s[3],targetObjectID:s[5]}):"groups"===r?(n={appID:i.Kii.getAppID(),groupID:s[1],type:"APP_AND_GROUP"},e={targetObjectScope:n,targetBucketID:s[3],targetObjectID:s[5]}):(n={appID:i.Kii.getAppID(),type:"APP"},e={targetObjectScope:n,targetBucketID:s[1],targetObjectID:s[3]}),e},e.prototype.moveBody=function(t,e){var n,s,r,o;if(o=this,null==t)throw i.InvalidArgumentException("targetObjectUri is required");if(null==o.getUUID())throw i.InvalidArgumentException("Source object is not saved on the cloud");return s=this._getPath()+"/body/move",r=new this._getRequest({path:s,withApp:!0}),r.setMethod("POST"),r.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json"),r.setData(this._parseObjectUri(t)),n={success:function(i,n){return 300>n&&n>=200&&null!=e?e.success(o,t):null!=e?e.failure(o,t,"Unable to parse response"):void 0},failure:function(i){return null!=e?e.failure(o,t,i):void 0}},r.execute(n,!0)},e}.call(this),i.KiiQuery=function(){function t(){this._dictValue=r(this._dictValue,this),this.sortByAsc=r(this.sortByAsc,this),this.sortByDesc=r(this.sortByDesc,this),this.setLimit=r(this.setLimit,this),this.getLimit=r(this.getLimit,this),this._setClause=r(this._setClause,this),this.setPaginationKey=r(this.setPaginationKey,this),this.getPaginationKey=r(this.getPaginationKey,this)}var e,n,s,o,u,a,h;return h=null,n=null,o=null,u=!1,a=null,s=25,e=null,t.prototype.getPaginationKey=function(){return this._paginationKey},t.prototype.setPaginationKey=function(t){this._paginationKey=t},t.prototype._setClause=function(t){this._clause=t},t.prototype.getLimit=function(){return this._limit},t.prototype.setLimit=function(t){if(t>0)return this._limit=t;throw new i.InvalidLimitException},t.queryWithClause=function(t){var e;return e=new i.KiiQuery,e._setClause(t),e},t.prototype.sortByDesc=function(t){return this._sortField=t,this._sortDescending=!0},t.prototype.sortByAsc=function(t){return this._sortField=t,this._sortDescending=!1},t._emptyDictValue=function(){return{type:"all"}},t.prototype._dictValue=function(){var t;return t={descending:this._sortDescending},t.clause=null!=this._clause?this._clause._getDictValue():i.KiiQuery._emptyDictValue(),null!=this._sortField&&(t.orderBy=this._sortField),t},t}.call(this),i.KiiClause=function(){function t(){this._getDictValue=r(this._getDictValue,this),this._setDictValue=r(this._setDictValue,this),this._setWhereClauses=r(this._setWhereClauses,this),this._setWhereType=r(this._setWhereType,this)}var e,n,s;return e=null,s=null,n=null,t.constructor=function(){return t._whereClauses=[],t._dictExpression={}},t.prototype._setWhereType=function(t){this._whereType=t},t.prototype._setWhereClauses=function(t){this._whereClauses=t},t.prototype._setDictValue=function(t){this._dictExpression=t},t.prototype._getDictValue=function(){var t,e,n,s,r,o;if(n={},null!=this._whereClauses&&null!=this._whereType)if(e=[],1===this._whereClauses.length)t=this._whereClauses[0],n="not"===this._whereType?{type:this._whereType,clause:t._getDictValue()}:t._getDictValue();else{for(o=this._whereClauses,s=0,r=o.length;r>s;s++)t=o[s],e.push(t._getDictValue());n={type:this._whereType,clauses:e}}else null!=this._whereClauses?this._whereClauses.length>0&&(n=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(n=this._dictExpression);return null==n&&(n=i.KiiQuery.emptyDictValue()),n},t.createWithWhere=function(t,e){var n;return n=new i.KiiClause,n._setWhereType(t),n._setWhereClauses(e),n},t.create=function(t,e,n){var s,r;return s=new i.KiiClause,r={},"="===t?(r.type="eq",r.field=e,r.value=n):"<"===t?(r.type="range",r.field=e,r.upperLimit=n,r.upperIncluded=!1):"<="===t?(r.type="range",r.field=e,r.upperLimit=n,r.upperIncluded=!0):">"===t?(r.type="range",r.field=e,r.lowerLimit=n,r.lowerIncluded=!1):">="===t?(r.type="range",r.field=e,r.lowerLimit=n,r.lowerIncluded=!0):"in"===t?(r.type="in",r.field=e,r.values=n):"prefix"===t&&(r.type="prefix",r.field=e,r.prefix=n),s._setDictValue(r),s},t.and=function(){return t.createWithWhere("and",arguments)},t.or=function(){return t.createWithWhere("or",arguments)},t.equals=function(t,e){return null!=e._className&&(e=e.objectURI),i.KiiClause.create("=",t,e)},t.notEquals=function(t,e){return null!=e._className&&(e=e.objectURI),i.KiiClause.createWithWhere("not",[i.KiiClause.equals(t,e)])},t.greaterThan=function(t,e){return i.KiiClause.create(">",t,e)},t.greaterThanOrEqual=function(t,e){return i.KiiClause.create(">=",t,e)},t.lessThan=function(t,e){return i.KiiClause.create("<",t,e)},t.lessThanOrEqual=function(t,e){return i.KiiClause.create("<=",t,e)},t["in"]=function(t,e){return i.KiiClause.create("in",t,e)},t.startsWith=function(t,e){return i.KiiClause.create("prefix",t,e)},t.geoDistance=function(t,e,n,s){var r,o,u,a,h;if(u=function(t){return"string"==typeof t&&t.length>0},o=function(t){return null==t?!1:t instanceof KiiGeoPoint},!u(t))throw i.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!o(e))throw i.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(a="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=s&&!s.match(a))throw i.InvalidArgumentException("putDistanceInto is invalid.");if(0>=n||n>2e7||isNaN(n))throw i.InvalidArgumentException("radius is invalid.");return r=new i.KiiClause,h={},h.type="geodistance",h.field=t,e=e._toDict(),h.center=e,h.radius=n,h.putDistanceInto=s,r._setDictValue(h),r},t.geoBox=function(t,e,n){var s,r,o,u,a,h;if(o=function(t){return"string"==typeof t&&t.length>0},r=function(t){return null==t?!1:t instanceof KiiGeoPoint},!o(t))throw i.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!r(e)||!r(n))throw i.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");
return s=new i.KiiClause,h={},h.type="geobox",h.field=t,u=e._toDict(),a=n._toDict(),h.box={ne:u,sw:a},s._setDictValue(h),s},t}.call(this),t=function(){function t(t,e){this.execute=r(this.execute,this),this.setAdminToken=r(this.setAdminToken,this),this.addHeader=r(this.addHeader,this),this.setAccept=r(this.setAccept,this),this.getAccept=r(this.getAccept,this),this.setAnonymous=r(this.setAnonymous,this),this.isAnonymous=r(this.isAnonymous,this),this.setContentType=r(this.setContentType,this),this.getContentType=r(this.getContentType,this),this.setData=r(this.setData,this),this.getData=r(this.getData,this),this.setHeaders=r(this.setHeaders,this),this.getHeaders=r(this.getHeaders,this),this.setMethod=r(this.setMethod,this),this.getMethod=r(this.getMethod,this),this.setPath=r(this.setPath,this),this.getPath=r(this.getPath,this);n=this,this._path=e?"/apps/"+i.Kii.getAppID()+t:t,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){},this._failure=function(){}}var e,n;return n=null,t._path=null,t._method=null,t._headers=null,t._data=null,t._contentType=null,t._anonymous=!1,t._accept=null,t._success=null,t._failure=null,e=null,t.prototype.getPath=function(){return this._path},t.prototype.setPath=function(t){this._path=t},t.prototype.getMethod=function(){return this._method},t.prototype.setMethod=function(t){this._method=t},t.prototype.getHeaders=function(){return this._headers},t.prototype.setHeaders=function(t){this._headers=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getContentType=function(){return this._contentType},t.prototype.setContentType=function(t){this._contentType=t},t.prototype.isAnonymous=function(){return this._anonymous},t.prototype.setAnonymous=function(t){this._anonymous=t},t.prototype.getAccept=function(){return this._accept},t.prototype.setAccept=function(t){this._accept=t},t.prototype.addHeader=function(t,e){return this._headers[t]=e},t.prototype.setAdminToken=function(t){return this._adminToken=t},t.prototype.execute=function(t,e){var s,r,o,u,a,h,c;this._success=null!=t.success?t.success:this._success,this._failure=null!=t.failure?t.failure:this._failure,a=i.Kii.getBaseURL()+this._path,i.Kii.logger("POSTING: "),i.Kii.logger(this._data),null!=this._data&&(u={}),c=this._data;for(o in c)h=c[o],u[o]=encodeURIComponent(h);return r=JSON.stringify(this._data),i.Kii.logger("Making request["+this._method+"] to "+a+" with data: "+r),this._headers["x-kii-appid"]=i.Kii.getAppID(),this._headers["x-kii-appkey"]=i.Kii.getAppKey(),this._headers["x-kii-sdk"]=i.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==i.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+i.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),i.Kii.logger("Headers: "),i.Kii.logger(this._headers),$.support.cors=!0,s={type:this._method,url:a,dataType:"json",headers:this._headers,contentType:this._contentType,error:function(t,e,s){var r,o;r=s?s:e+" : "+a;try{o=jQuery.parseJSON(decodeURIComponent(t.responseText))}catch(u){s=u,o=null}return null!=o&&null!=o.errorCode&&(r=o.errorCode,null!=o.message&&(r+=": "+o.message)),i.Kii.logger("Failure: "+r),i.Kii.logger(t.responseText),n._failure(r,t.status)},success:function(t,s,r){var o,u,a;if(i.Kii.logger("Completed Request["+r.status+"]"),i.Kii.logger(r.responseText),e)return n._success(null,r.status);try{a=jQuery.parseJSON(r.responseText)}catch(h){o=h,a=null}return null!=a?null!=a.errorCode?(u=a.errorCode,null!=a.message&&(u+=": "+a.message),n._failure(u,r.status,a.errorCode)):n._success(a,r.status):n._success(null,r.status,null)}},"GET"!==this._method&&null!=r&&(s.data=r,s.processData=!1),$.ajax(s)},t}(),i.KiiUser=function(){function n(){this._getRequest=r(this._getRequest,this),this._updateWithJSON=r(this._updateWithJSON,this),this["delete"]=r(this["delete"],this),this.refresh=r(this.refresh,this),this.save=r(this.save,this),this.changeEmail=r(this.changeEmail,this),this.changePhone=r(this.changePhone,this),this.ownerOfGroups=r(this.ownerOfGroups,this),this.memberOfGroups=r(this.memberOfGroups,this),this.resendPhoneNumberVerification=r(this.resendPhoneNumberVerification,this),this.resendEmailVerification=r(this.resendEmailVerification,this),this.resendVerification=r(this.resendVerification,this),this.verifyPhoneNumber=r(this.verifyPhoneNumber,this),this.verifyCredentials=r(this.verifyCredentials,this),this.updatePassword=r(this.updatePassword,this),this.register=r(this.register,this),this._authenticateWithToken=r(this._authenticateWithToken,this),this._authenticate=r(this._authenticate,this),this.bucketWithName=r(this.bucketWithName,this),this.get=r(this.get,this),this.set=r(this.set,this),this.objectURI=r(this.objectURI,this),this._setAccessToken=r(this._setAccessToken,this),this.getAccessToken=r(this.getAccessToken,this),this._setPhoneVerified=r(this._setPhoneVerified,this),this.getPhoneVerified=r(this.getPhoneVerified,this),this._setEmailVerified=r(this._setEmailVerified,this),this.getEmailVerified=r(this.getEmailVerified,this),this._setModified=r(this._setModified,this),this.getModified=r(this.getModified,this),this._setCreated=r(this._setCreated,this),this.getCreated=r(this.getCreated,this),this.setCountry=r(this.setCountry,this),this.getCountry=r(this.getCountry,this),this._setPassword=r(this._setPassword,this),this._setPhoneNumber=r(this._setPhoneNumber,this),this.getPhoneNumber=r(this.getPhoneNumber,this),this._setEmailAddress=r(this._setEmailAddress,this),this.getEmailAddress=r(this.getEmailAddress,this),this._validateDisplayName=r(this._validateDisplayName,this),this.setDisplayName=r(this.setDisplayName,this),this.getDisplayName=r(this.getDisplayName,this),this._setUsername=r(this._setUsername,this),this.getUsername=r(this.getUsername,this),this._setUUID=r(this._setUUID,this),this.getUUID=r(this.getUUID,this),this._customInfo={}}var s,o,u,a,h,c,l,_,p,g,d,f,m,y;return f=null,y=null,m=null,h=null,p=null,c=null,g=null,o=null,u=null,_=null,l=null,d=null,s=null,a=null,n.prototype.getUUID=function(){return this._uuid},n.prototype._setUUID=function(t){this._uuid=t},n.prototype.getUsername=function(){return this._username},n.prototype._setUsername=function(t){if(i.Kii.logger("Setting username: "+t),e._validateUsername(t))return this._username=$.trim(t);throw new i.InvalidUsernameException},n.prototype.getDisplayName=function(){return this._displayName},n.prototype.setDisplayName=function(t){return this._validateDisplayName(t),this._displayName=t},n.prototype._validateDisplayName=function(t){if(typeof t===!1)throw new i.InvalidDisplayNameException;if(4>t.length||t.length>50)throw new i.InvalidDisplayNameException},n.prototype.getEmailAddress=function(){return this._emailAddress},n.prototype._setEmailAddress=function(t){if(i.Kii.logger("Setting email: "+t),e._validateEmail(t))return this._emailAddress=$.trim(t);throw new i.InvalidEmailException},n.prototype.getPhoneNumber=function(){return this._phoneNumber},n.prototype._setPhoneNumber=function(t){if(i.Kii.logger("Setting phone number: "+t),e._validatePhoneNumber(t))return this._phoneNumber=t;throw new i.InvalidPhoneNumberException},n.prototype._setPassword=function(t){if(e._validatePassword(t))return this._password=t;throw new i.InvalidPasswordException},n.prototype.getCountry=function(){return this._country},n.prototype.setCountry=function(t){if(e._validateCountryCode(t))return this._country=t;throw new i.InvalidCountryException},n.prototype.getCreated=function(){return this._created},n.prototype._setCreated=function(t){this._created=t},n.prototype.getModified=function(){return this._modified},n.prototype._setModified=function(t){this._modified=t},n.prototype.getEmailVerified=function(){return this._emailVerified},n.prototype._setEmailVerified=function(t){this._emailVerified=t},n.prototype.getPhoneVerified=function(){return this._phoneVerified},n.prototype._setPhoneVerified=function(t){this._phoneVerified=t},n.prototype.getAccessToken=function(){return i.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},n.prototype._setAccessToken=function(t){return this._accessToken=t,i.Kii.logger("Setting access token: "+this._accessToken)},n.prototype.objectURI=function(){var t;return null!=this._uuid&&(t="kiicloud://users/"+this._uuid),t},n.prototype.set=function(t,e){return i.Kii.logger(this),i.Kii.logger(this._customInfo),this._customInfo[t]=e},n.prototype.get=function(t){return this._customInfo[t]},n.getCurrentUser=function(){return i.Kii.getCurrentUser()},n.userWithUsername=function(t,e){var n;return n=new i.KiiUser,n._setUsername(t),n._setPassword(e),n},n._userWithEmailAddress=function(t,e){var n;return n=new i.KiiUser,n._setEmailAddress(t),n._setPassword(e),n},n._userWithPhoneNumber=function(t,e){var n;return n=new i.KiiUser,n._setPhoneNumber(t),n._setPassword(e),n},n.userWithPhoneNumber=function(t,e){var n;return n=new i.KiiUser,n._setPhoneNumber(t),n._setPassword(e),n},n.userWithPhoneNumberAndUsername=function(t,e,n){var s;return s=new i.KiiUser,s._setPhoneNumber(t),s._setUsername(e),s._setPassword(n),s},n.userWithEmailAddress=function(t,e){var n;return n=new i.KiiUser,n._setEmailAddress(t),n._setPassword(e),n},n.userWithEmailAddressAndUsername=function(t,e,n){var s;return s=new i.KiiUser,s._setEmailAddress(t),s._setUsername(e),s._setPassword(n),s},n.userWithEmailAddressAndPhoneNumber=function(t,e,n){var s;return s=new i.KiiUser,s._setEmailAddress(t),s._setPhoneNumber(e),s._setPassword(n),s},n.userWithCredentials=function(t,e,n,s){var r;return r=new i.KiiUser,r._setEmailAddress(t),r._setPhoneNumber(e),r._setUsername(n),r._setPassword(s),r},n._validateURI=function(t){var e,i,n;return t=$.trim(t),i=/^kiicloud:\/\/users\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i,"string"===(typeof t).toLowerCase()&&(e=t.match(i),null!=e&&(n=e[1])),n},n.userWithURI=function(t){var e,n;if(i.Kii.logger("About to extract from: "+t),n=i.KiiUser._validateURI(t),i.Kii.logger("Extracted uuid from uri: "+n),null==n)throw new i.InvalidURIException;return e=new i.KiiUser,e._setUUID(n),e},n._userWithID=function(t){var e;return e=new i.KiiUser,e._setUUID(t),e},n.prototype.bucketWithName=function(t){return new i.KiiBucket._bucketWithName(t,this)},n.prototype._authenticate=function(t){var e,n,s;return f=this,i.Kii.logger("Authenticating user:"),i.Kii.logger(this),i.Kii.logger("Email verified: "+this._emailVerified),i.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?s=this._username:null!=this._emailAddress&&this._emailVerified===!0?s=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?s=this._phoneNumber:null!=this._emailAddress?s=this._emailAddress:null!=this._phoneNumber&&(s=this._phoneNumber),n=this._getRequest({path:"/oauth2/token",withApp:!1}),n.setAnonymous(!0),n.setMethod("POST"),n.setData({username:s,password:this._password}),e={success:function(e){return f._setUUID(e.id),f._setAccessToken(e.access_token),i.Kii.setCurrentUser(f),null!=t?t.success(i.Kii.getCurrentUser()):void 0},failure:function(e){return null!=t?t.failure(f,e):void 0}},n.execute(e,!1)},n.prototype._authenticateWithToken=function(t,e){var n,s;return f=this,i.Kii.logger("Authenticating user "+this),i.Kii.logger(e),s=this._getRequest({path:"/users/me",withApp:!0}),s.setAnonymous(!0),s.addHeader("Authorization","Bearer "+t),n={success:function(n){return f._updateWithJSON(n),f._setAccessToken(t),i.Kii.setCurrentUser(f),null!=e?e.success(i.Kii.getCurrentUser()):void 0},failure:function(t){return null!=e?e.failure(f,t):void 0}},s.execute(n,!1)},n.authenticate=function(t,n,s){var r,o;try{if(i.Kii.logger("UserIdentifier: "+t),!e._validatePassword(n))throw new i.InvalidPasswordException;if(e._validateEmail(t))o=i.KiiUser._userWithEmailAddress(t,n);else if(e._validatePhoneNumber(t))o=i.KiiUser._userWithPhoneNumber(t,n);else{if(!e._validateUsername(t))throw new i.InvalidUserIdentifierException;o=i.KiiUser.userWithUsername(t,n)}return o._authenticate(s)}catch(u){if(r=u,null!=s)return s.failure(null,r.message)}},n.authenticateWithToken=function(t,e){var n;return n=new i.KiiUser,n._authenticateWithToken(t,e)},n.prototype.register=function(t){var e,n,s,r,o,u;f=this,i.Kii.logger("Registering user "+this),e={password:this._password},null!=this._username&&(e.loginName=this._username),null!=this._displayName&&(e.displayName=this._displayName),null!=this._emailAddress&&(e.emailAddress=this._emailAddress),null!=this._phoneNumber&&(e.phoneNumber=this._phoneNumber),null!=this._country&&(e.country=this._country),i.Kii.logger("CINFO"),i.Kii.logger(this._customInfo),u=this._customInfo;for(n in u)o=u[n],i.Kii.logger("Key/val: "+n+"/"+o),e[n]=o;return r=this._getRequest({path:"/users",withApp:!0}),r.setMethod("POST"),r.setData(e),r.setAnonymous(!0),r.setContentType("application/vnd.kii.RegistrationRequest+json"),s={success:function(e){return i.Kii.logger("Succreg"),f._updateWithJSON(e),f._authenticate(t)},failure:function(e){return i.Kii.logger("Failreg"),null!=t?t.failure(f,e):void 0}},r.execute(s,!1)},n.prototype.updatePassword=function(t,n,s){var r,o,u,a;return f=this,i.Kii.logger("Updating password from "+t+" to "+n),e._validatePassword(n)?(r={oldPassword:t,newPassword:n},o="/users/"+this._uuid+"/password",u=this._getRequest({path:o,withApp:!0}),u.setMethod("PUT"),u.setData(r),u.setContentType("application/vnd.kii.ChangePasswordRequest+json"),a={success:function(t,e){if(300>e&&e>=200){if(f._setPassword(n),null!=s)return s.success(f)}else if(null!=s)return s.failure(f,"Unable to change password")},failure:function(t){return null!=s?s.failure(f,t):void 0}},u.execute(a,!0)):null!=s?s.failure(f,(new i.InvalidPasswordException).message):void 0},n.resetPassword=function(n,s){var r,o,u,a;if(i.Kii.logger("Resetting password with identifier: "+n),e._validateEmail(n))r="EMAIL";else if(null!=s)return s.failure("Invalid user identifier. Must be a valid email address"),void 0;return null!=r?(o="/users/"+r+":"+n+"/password/request-reset",u=new t(o,!0),u.setMethod("POST"),u.setAnonymous(!0),a={success:function(t,e){return 300>e&&e>=200&&null!=s?s.success():null!=s?s.failure("Unable to reset password"):void 0},failure:function(t){return null!=s?s.failure(t):void 0}},u.execute(a,!0)):void 0},n.prototype.verifyCredentials=function(t,e,n){var s,r,o;return f=this,i.Kii.logger("Verifying "+t+" with code: "+e),s="/users/me/"+t+"/verify",r=this._getRequest({path:s,withApp:!0}),r.setMethod("POST"),r.setData({verificationCode:e}),r.setContentType("application/vnd.kii.AddressVerificationRequest+json"),o={success:function(e,i){if(300>i&&i>=200){if("email-address"===t?f._setEmailVerified(!0):"phone-number"===t&&f._setPhoneVerified(!0),null!=n)return n.success(f)}else if(null!=n)return n.failure(f,"Unable to verify "+t)},failure:function(t){return null!=n?n.failure(f,t):void 0}},r.execute(o,!0)},n.prototype.verifyPhoneNumber=function(t,e){return this.verifyCredentials("phone-number",t,e)},n.prototype.resendVerification=function(t,e){var n,s,r;return f=this,i.Kii.logger("Resending verification "+t),n="/users/me/"+t+"/resend-verification",s=this._getRequest({path:n,withApp:!0}),s.setMethod("POST"),r={success:function(i,n){return 300>n&&n>=200&&null!=e?e.success(f):null!=e?e.failure(f,"Unable to resend "+t+" verification"):void 0},failure:function(t){return null!=e?e.failure(f,t):void 0}},s.execute(r,!0)},n.prototype.resendEmailVerification=function(t){return this.resendVerification("email-address",t)},n.prototype.resendPhoneNumberVerification=function(t){return this.resendVerification("phone-number",t)},n.prototype.memberOfGroups=function(t){var e,n,s;return f=this,i.Kii.logger("Getting groups for member "+this._uuid),n="/groups/?is_member="+this._uuid,s=this._getRequest({path:n,withApp:!0}),s.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),e={success:function(e,n){var s,r,o,u,a;if(300>n&&n>=200){for(r=[],a=e.groups,o=0,u=a.length;u>o;o++)s=a[o],r.push(i.KiiGroup._groupWithJSON(s));if(null!=t)return t.success(f,r)}else if(null!=t)return t.failure(f,"Unable to retrieve groups")},failure:function(e){return null!=t?t.failure(f,e):void 0}},s.execute(e,!1)},n.prototype.ownerOfGroups=function(t){var e,n,s;return f=this,i.Kii.logger("Getting groups owned by the user "+this._uuid),n="/groups/?owner="+this._uuid,s=this._getRequest({path:n,withApp:!0}),s.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),e={success:function(e,n){var s,r,o,u,a;if(300>n&&n>=200){for(r=[],a=e.groups,o=0,u=a.length;u>o;o++)s=a[o],r.push(i.KiiGroup._groupWithJSON(s));if(null!=t)return t.success(f,r)}else if(null!=t)return t.failure(f,"Unable to retrieve groups")},failure:function(e){return null!=t?t.failure(f,e):void 0}},s.execute(e,!1)},n.prototype.changePhone=function(t,e){var n,s,r;return f=this,i.Kii.logger("Updating phone number to "+t),n="/users/"+this._uuid+"/phone-number",s=this._getRequest({path:n,withApp:!0}),s.setMethod("PUT"),s.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),s.setData({phoneNumber:t}),r={success:function(i,n){return 300>n&&n>=200&&null!=e?(f._setPhoneVerified(!1),f._setPhoneNumber(t),e.success(f)):null!=e?e.failure(f,"Unable to update phone number"):void 0},failure:function(t){return null!=e?e.failure(f,t):void 0}},s.execute(r,!0)},n.prototype.changeEmail=function(t,n){var s,r,o;return f=this,i.Kii.logger("Updating email address to: "+t),e._validateEmail(t)?(s="/users/"+this._uuid+"/email-address",r=this._getRequest({path:s,withApp:!0}),r.setMethod("PUT"),r.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),r.setData({emailAddress:t}),o={success:function(e,i){return 300>i&&i>=200&&null!=n?(f._setEmailVerified(!1),f._setEmailAddress(t),n.success(f)):null!=n?n.failure(f,"Unable to update email address"):void 0},failure:function(t){return null!=n?n.failure(f,t):void 0}},r.execute(o,!0)):n.failure(f,"Invalid email address format")},n.prototype.save=function(t){var e,n,s,r;return f=this,i.Kii.logger("Saving user: "+this._uuid),n="/users/"+this._uuid,i.Kii.logger("CUSTOMINFO: "),i.Kii.logger(this._customInfo),s=this._getRequest({path:n,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.UserUpdateRequest+json"),e=this._customInfo,null!=this._country&&(e.country=this._country),null!=this._displayName&&(e.displayName=this._displayName),s.setData(e),r={success:function(e,i){if(300>i&&i>=200){if(f._setModified(e.modifiedAt),null!=t)return t.success(f)}else if(null!=t)return t.failure(f,"Unable to parse response")},failure:function(e){return null!=t?t.failure(f,e):void 0}},s.execute(r,!1)},n.prototype.refresh=function(t){var e,n;return f=this,i.Kii.logger("Refreshing user: "+this._uuid),n=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),e={success:function(e,i){if(300>i&&i>=200){if(f._updateWithJSON(e),null!=t)return t.success(f)}else if(null!=t)return t.failure(f,"Unable to parse response")},failure:function(e){return null!=t?t.failure(f,e):void 0}},n.execute(e,!1)},n.prototype["delete"]=function(t){var e,n;return i.Kii.logger("Deleting user..."),f=this,n=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),n.setMethod("DELETE"),e={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success(f):null!=t?t.failure(f,"Unable to parse response"):void 0},failure:function(e){return null!=t?t.failure(f,e):void 0}},n.execute(e,!0)},n.logOut=function(){return i.Kii.logOut()},n.loggedIn=function(){return i.Kii.loggedIn()},n.getCurrentUser=function(){return i.Kii.getCurrentUser()},n.prototype._updateWithJSON=function(t){var e,n;i.Kii.logger("Updating with:"),i.Kii.logger(t);for(e in t)n=t[e],i.Kii.logger("key/val => "+e+"/"+n),i.Kii.logger("Substr "+e.substring(0,1)),"userID"===e||"id"===e?this._uuid=n:"created"===e||"createdAt"===e||"_created"===e?this._created=n:"modified"===e||"modifiedAt"===e||"_modified"===e?this._modified=n:"loginName"===e?this._username=n:"displayName"===e?this._displayName=n:"country"===e?(i.Kii.logger("Is setting country"),this._country=n):"emailAddress"===e?this._emailAddress=n:"phoneNumber"===e?this._phoneNumber=n:"emailAddressVerified"===e?(i.Kii.logger("Email verified: "+n),this._emailVerified=n):"phoneNumberVerified"===e?(i.Kii.logger("Phone verified: "+n),this._phoneVerified=n):""===e?(i.Kii.logger("Setting empty to custom info"),this._customInfo[e]=n):e.substring(0,!0)?(i.Kii.logger("Setting to custom info"),this._customInfo[e]=n):i.Kii.logger("Doing nothing");return null==this._displayName&&null!=this._username?this._displayName=this._username:void 0},n.prototype._getRequest=function(e){var i,n,s;return i=e.path,s=e.withApp,n=new t(i,s)},n}.call(this),e=function(){function t(){}return t.arrayRemove=function(t,e,i){var n;return n=t.slice((i||e)+1||t.length),t.length=0>e?t.length+e:e,t.push.apply(t,n)},t._validateEmail=function(t){var e;return t=$.trim(t),e=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof t).toLowerCase()?(i.Kii.logger("Not string"),!1):t.match(e)?!0:!1},t._validatePhoneNumber=function(t){var e;return t=$.trim(t),e=/^[\\+]+[0-9]{10,}$/i,"string"!==(typeof t).toLowerCase()?(i.Kii.logger("Not string"),!1):t.match(e)?!0:!1},t._validateLocalPhone=function(t){var e;return t=$.trim(t),e=/^\d+$/,"string"!==(typeof t).toLowerCase()?(i.Kii.logger("Not string"),!1):t.match(e)?!0:(i.Kii.logger("Invalid format"),!1)},t._assertLocalPhoneIsValid=function(e){if(!t._validateLocalPhone(e))throw new i.InvalidLocalPhoneNumberException},t._validateCountryCode=function(t){var e;return t=$.trim(t),e=/^[a-z]{2}$/i,"string"!==(typeof t).toLowerCase()?(i.Kii.logger("Not string"),!1):t.match(e)?(i.Kii.logger("Is true"),!0):!1},t._assertCountryCodeIsValid=function(e){if(!t._validateCountryCode(e))throw new i.InvalidCountryException},t._validatePassword=function(t){var e;return i.Kii.logger("Validating password: "+t),e=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof t).toLowerCase()?(i.Kii.logger("not string"),!1):t.match(e)?(i.Kii.logger("matched"),!0):(i.Kii.logger("other exception"),!1)},t._assertPasswordIsValid=function(e){if(!t._validatePassword(e))throw new i.InvalidPasswordException},t._validateUsername=function(t){var e;return e=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof t).toLowerCase()?!1:t.match(e)?!0:!1},t}.call(this),i.KiiSocialConnect=function(){function t(){}var e;return e=null,t.setupNetwork=function(t,n,r,o){var u;return null==e&&(e=new s),u=e._getManager(t),u._reset(),u._setup(n,r,o),i.Kii.logger("Set key: "+u._key)},t.logIn=function(t,n,s){var r;return r=!1,null!=e&&(i.Kii.logger("And manager: "),i.Kii.logger(e._getManager(t)),e._getManager(t)&&(e._getManager(t)._logIn(n,s),r=!0)),i.Kii.logger("Callbacks"),i.Kii.logger(s),r||null==s?void 0:s.failure(i.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.linkCurrentUserWithNetwork=function(t,n,s){var r;return i.Kii.logger("Trying with instance"),i.Kii.logger(e),r=!1,null!=e&&(i.Kii.logger("And manager: "),i.Kii.logger(e._getManager(t)),e._getManager(t)&&(e._getManager(t)._linkWithCurrentUser(n,s),r=!0)),i.Kii.logger("Callbacks"),i.Kii.logger(s),r||null==s?void 0:s.failure(i.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.unLinkCurrentUserFromNetwork=function(t,n){if(i.Kii.logger("Trying with instance"),i.Kii.logger(e),null!=e){if(i.Kii.logger("And manager: "),i.Kii.logger(e._getManager(t)),e._getManager(t))return e._getManager(t)._unlinkFromCurrentUser(n)}else if(null!=n)return n.failure(i.KiiUser.getCurrentUser(),t,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},t.getAccessTokenForNetwork=function(t){return e._getManager(t)._getToken()},t.getAccessTokenExpirationForNetwork=function(t){return e._getManager(t)._getTokenExpiration()},t.getAccessTokenObjectForNetwork=function(t){return e._getManager(t)._getTokenObject()},t.logOutAll=function(){var t,n;return null!=e&&(t=e._getManager(i.KiiSocialNetworkName.FACEBOOK),null!=t&&t._logOut(),n=e._getManager(i.KiiSocialNetworkName.TWITTER),null!=n)?n._logOut():void 0},t}.call(this),s=function(){function t(){this._getManager=r(this._getManager,this)}var e,n;return e=null,n=null,t.prototype._getManager=function(t){return t===i.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new i.KiiSCNFacebook:t===i.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new i.KiiSCNTwitter:void 0},t}(),i.KiiSocialConnectNetwork=function(){function t(t){this._network=t,this._setup=r(this._setup,this),this._unlinkFromCurrentUser=r(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=r(this._linkWithCurrentUser,this),this._logOut=r(this._logOut,this),this._logIn=r(this._logIn,this),this._reset=r(this._reset,this),this._isAuthenticated=r(this._isAuthenticated,this),this._getCallbacks=r(this._getCallbacks,this),this._setCallbacks=r(this._setCallbacks,this),this._getTokenObject=r(this._getTokenObject,this),this._setTokenObject=r(this._setTokenObject,this),this._getTokenExpiration=r(this._getTokenExpiration,this),this._setTokenExpiration=r(this._setTokenExpiration,this),this._getToken=r(this._getToken,this),this._setToken=r(this._setToken,this),this._getExtras=r(this._getExtras,this),this._setExtras=r(this._setExtras,this),this._getSecret=r(this._getSecret,this),this._setSecret=r(this._setSecret,this),this._getKey=r(this._getKey,this),this._setKey=r(this._setKey,this),this._getNetwork=r(this._getNetwork,this),this._setNetwork=r(this._setNetwork,this)}var e,i,n,s,o,u,a,h;return t.prototype._className="KiiSocialConnectNetwork",s=null,n=null,o=null,i=null,u=null,a=null,h=null,e=null,t.prototype._setNetwork=function(t){this._network=t},t.prototype._getNetwork=function(){return this._network},t.prototype._setKey=function(t){this._key=t},t.prototype._getKey=function(){return this._key},t.prototype._setSecret=function(t){this._secret=t},t.prototype._getSecret=function(){return this._secret},t.prototype._setExtras=function(t){this._extras=t},t.prototype._getExtras=function(){return this._extras},t.prototype._setToken=function(t){this._token=t},t.prototype._getToken=function(){return this._token},t.prototype._setTokenExpiration=function(t){this._tokenExpiration=t},t.prototype._getTokenExpiration=function(){return this._tokenExpiration},t.prototype._setTokenObject=function(t){this._tokenObject=t},t.prototype._getTokenObject=function(){return this._tokenObject},t.prototype._setCallbacks=function(t){this._callbacks=t},t.prototype._getCallbacks=function(){return this._callbacks},t.prototype._isAuthenticated=function(){return null!=this._tokenObject},t.prototype._reset=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null,this._key=null,this._secret=null,this._extras=null},t.prototype._logIn=function(t,e){this._callbacks=e},t.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},t.prototype._linkWithCurrentUser=function(t,e){this._callbacks=e},t.prototype._unlinkFromCurrentUser=function(t){this._callbacks=t},t.prototype._setup=function(t,e,i){this._key=t,this._secret=e,this._extras=i},t}(),i.KiiSCNFacebook=function(e){function n(){this._unlinkFromCurrentUser=r(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=r(this._linkWithCurrentUser,this),this._logOut=r(this._logOut,this),this._logIn=r(this._logIn,this),this._unlink=r(this._unlink,this),this._link=r(this._link,this),this._register=r(this._register,this),this._setup=r(this._setup,this),n.__super__.constructor.call(this,KiiSocialNetworkName.FACEBOOK)}var s;return u(n,e),s=null,n.prototype._setup=function(t,e,s){return this._key=t,this._secret=e,this._extras=s,n.__super__._setup.call(this,this._key,this._secret,this._extras),this._extras.appId=this._key,i.Kii.logger(this._extras),FB.init(this._extras)},n.prototype._register=function(e,n){var s,r,o=this;return o=this,r=new t("/integration/facebook",!0),r.setMethod("POST"),r.setData({accessToken:e}),r.setAnonymous(!0),r.setContentType("application/vnd.kii.AuthTokenFacebookRequest+json"),s={success:function(t){var s,r;return o._setToken(e),o._setTokenExpiration(n),s={access_token:e,expires_in:n},o._setTokenObject(s),r=new i.KiiUser,r._updateWithJSON(t),r._setAccessToken(t.access_token),i.Kii.setCurrentUser(r),null!=o._callbacks?o._callbacks.success(i.KiiUser.getCurrentUser(),o._network):void 0},failure:function(t){return null!=o._callbacks?o._callbacks.failure(null,o._network,t):void 0}},r.execute(s,!1)},n.prototype._link=function(e,n){var s,r,o=this;return o=this,r=new t("/users/me/facebook/link",!0),r.setMethod("POST"),r.setData({accessToken:e}),s={success:function(){var t;return o._setToken(e),o._setTokenExpiration(n),t={access_token:e,expires_in:n},o._setTokenObject(t),null!=o._callbacks?o._callbacks.success(i.KiiUser.getCurrentUser(),o._network):void 0},failure:function(t){return null!=o._callbacks?o._callbacks.failure(i.KiiUser.getCurrentUser(),o._network,t):void 0}},r.execute(s,!0)},n.prototype._unlink=function(){var e,n,s=this;return s=this,e=new t("/users/me/facebook/unlink",!0),e.setMethod("POST"),n={success:function(){return s._setToken(null),s._setTokenExpiration(null),s._setTokenObject(null),null!=s._callbacks?s._callbacks.success(i.KiiUser.getCurrentUser(),s._network):void 0},failure:function(t){return null!=s._callbacks?s._callbacks.failure(i.KiiUser.getCurrentUser(),s._network,t):void 0}},e.execute(n,!0)},n.prototype._logIn=function(t,e){var s,r,o,u=this;return n.__super__._logIn.call(this,t,e),i.Kii.logger("should auth fb"),u=this,i.Kii.logger("Checking options"),i.Kii.logger(t),s=function(t){return null!=t.authResponse?(null!=i.KiiUser.getCurrentUser()&&KiiUser.logOut(),u._register(t.authResponse.accessToken,t.authResponse.expiresIn)):null!=u._callbacks?u._callbacks.failure(null,u._network,"User cancelled login or did not fully authorize"):void 0},null!=t&&null!=t.access_token?(i.Kii.logger("Have options: "),i.Kii.logger(t),null!=i.KiiUser.getCurrentUser()&&KiiUser.logOut(),u._register(t.access_token,null)):(r=null,null!=t&&null!=t.scope&&(r={scope:t.scope}),o=function(t){return"connected"===t.status?s(t):FB.login(s,r)},FB.getLoginStatus(o),o=function(t){return"connected"===t.status?s(t):FB.login(s)},FB.getLoginStatus(o))},n.prototype._logOut=function(){return n.__super__._logOut.apply(this,arguments),i.Kii.logger("Log out fb")},n.prototype._linkWithCurrentUser=function(t,e){var s,r,o,u;return n.__super__._linkWithCurrentUser.call(this,t,e),u=this,s=function(t){return t.authResponse?u._link(t.authResponse.accessToken,t.authResponse.expiresIn):null!=u._callbacks?u._callbacks.failure(null,u._network,"User cancelled Facebook login or did not fully authorize"):void 0},null!=i.KiiUser.getCurrentUser()?null!=t&&null!=t.access_token?u._link(t.access_token,null):(r=null,null!=t&&null!=t.scope&&(r={scope:t.scope}),o=function(t){return"connected"===t.status?s(t):FB.login(s,r)},FB.getLoginStatus(o)):null!=e?e.failure("A KiiUser must be logged in before linking to Facebook"):void 0},n.prototype._unlinkFromCurrentUser=function(t){return n.__super__._unlinkFromCurrentUser.call(this,t),null!=i.KiiUser.getCurrentUser()?this._unlink():null!=t?t.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},n}(i.KiiSocialConnectNetwork),i.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 4-50 characters."},i.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},i.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"
},i.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},i.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},i.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},i.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},i.InvalidCountryException=function(){return a.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},i.InvalidURIException=function(){return a.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},i.InvalidACLAction=function(){return a.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},i.InvalidACLSubject=function(){return a.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},i.InvalidACLGrant=function(){return a.message="Unable to set ACL grant. Must be a boolean type"},i.InvalidLimitException=function(){return a.message="Unable to set query limit. Must be an integer > 0"},i.InvalidArgumentException=function(t){return a.message="InvalidArgument: "+t},i.KiiAppAdminContext=function(){function t(t){this._getToken=r(this._getToken,this),this._getId=r(this._getId,this),this._objectWithURI=r(this._objectWithURI,this),this._token=t.token,this._id=t.id}var e,n;return n=null,e=null,t.prototype.bucketWithName=function(t){var e;return e=new i.KiiBucketAdmin(t,null,this._token)},t.prototype.groupWithName=function(t){var e;return e=i.KiiGroupAdmin._groupWithName(t,this)},t.prototype.userWithID=function(t){var e;return e=i.KiiUserAdmin._userWithID(t,this)},t.prototype._userWithLoginName=function(t,e){var n,s,r;return r=new i.KiiUserAdmin(this),s=r._getRequest({path:"/users/LOGIN_NAME:"+t,withApp:!0}),s.setAdminToken(this._token),n={success:function(t,i){if(300>i&&i>=200){if(r._updateWithJSON(t),null!=e)return e.success(r)}else if(null!=e)return e.failure("Unable to parse response")},failure:function(t){return null!=e?e.failure(t):void 0}},s.execute(n,!1)},t.prototype._objectWithURI=function(t){var e,n,s,r,o,u,a,h,c,l;if(a=t.substr("kiicloud://".length),o=a.split("/"),r=o.length,!(r>=4))throw new i.InvalidURIException;return n=4===r?1:3,s=o[n],"groups"===o[0]?u=new i.KiiGroupAdmin._groupWithID(o[1],this._token):"users"===o[0]&&(l=i.KiiUserAdmin._userWithID(o[1],this._token)),c=null,null!=u?c=u:null!=l&&(c=l),e=new i.KiiBucketAdmin(s,c,this._token),h=e.createObject(),h._setUUID(o[r-1]),h},t.prototype._getId=function(){return this._id},t.prototype._getToken=function(){return this._token},t}(),i.KiiACLAdmin=function(t){function e(t,i){this._userWithID=r(this._userWithID,this),this._groupWithID=r(this._groupWithID,this),this._getRequest=r(this._getRequest,this),e.__super__.constructor.call(this),this._setParent(t),this._adminToken=i}var n;return u(e,t),n=null,e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._adminToken),i},e.prototype._groupWithID=function(t){var e;return e=i.KiiGroupAdmin._groupWithID(t,this._adminToken)},e.prototype._userWithID=function(t){var e;return e=i.KiiUserAdmin._userWithID(t,this._adminToken)},e}(i.KiiACL),i.KiiGroupAdmin=function(t){function e(t){this._setOwnerFromContext=r(this._setOwnerFromContext,this),this._userWithID=r(this._userWithID,this),this.bucketWithName=r(this.bucketWithName,this),this._getRequest=r(this._getRequest,this),e.__super__.constructor.call(this),this._adminContext=t}var n;return u(e,t),n=null,e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._adminContext._getToken()),i},e._groupWithName=function(t,e){return i.KiiGroupAdmin._groupWithNameAndMembers(t,null,e)},e._groupWithNameAndMembers=function(t,e,n){var s;return s=new i.KiiGroupAdmin(n),s._setName(t),s._setAddMembers(e),s},e._groupWithID=function(t,e){var n;return n=new i.KiiGroupAdmin(e),n._setUUID(t),n},e.prototype.bucketWithName=function(t){var e;return e=new i.KiiBucketAdmin(t,this,this._adminContext._getToken())},e.prototype._userWithID=function(t){var e;return e=i.KiiUserAdmin._userWithID(t,this._adminContext._getToken())},e.prototype._setOwnerFromContext=function(){},e}.call(this,i.KiiGroup),i.KiiObjectAdmin=function(t){function e(t){this._userWithID=r(this._userWithID,this),this.objectACL=r(this.objectACL,this),this._getRequest=r(this._getRequest,this),e.__super__.constructor.call(this),this._adminToken=t}var n;return u(e,t),n=null,e.prototype._getRequest=function(t){var n;return i.Kii.logger("admin req: "+this._adminToken),n=e.__super__._getRequest.call(this,t),n.setAdminToken(this._adminToken),n},e.objectWithBucket=function(t,e,n){var s;return i.Kii.logger("Creating object w type: "+e),s=new i.KiiObjectAdmin(n),s._setBucket(t),s._setObjectType(e),i.Kii.logger(s),s},e.prototype.objectACL=function(){var t;return t=new i.KiiACLAdmin(this,this._adminToken)},e.prototype._userWithID=function(t){var e;return e=i.KiiUserAdmin._userWithID(t,this._adminToken)},e}.call(this,i.KiiObject),i.KiiUserAdmin=function(t){function e(t){this.bucketWithName=r(this.bucketWithName,this),this._getRequest=r(this._getRequest,this),e.__super__.constructor.call(this),this._adminContext=t}var n;return u(e,t),n=null,e._userWithID=function(t,e){var n;return n=new i.KiiUserAdmin(e),n._setUUID(t),n},e.prototype._getRequest=function(t){var i;return i=e.__super__._getRequest.call(this,t),i.setAdminToken(this._adminContext._getToken()),i},e.prototype.bucketWithName=function(t){var e;return e=new i.KiiBucketAdmin(t,this,this._adminContext._getToken())},e}.call(this,i.KiiUser),i.KiiAnonymousUser=function(){function t(){}return t}(),i.KiiAnyAuthenticatedUser=function(){function t(){}return t}(),i.KiiSDKClientInfo=function(){function t(){}var e;return e=null,t.getSDKClientInfo=function(){return null==t._clientInfo&&(t._clientInfo="sn=jss;sv="+i.Kii.getSDKVersion()),t._clientInfo},t}.call(this),i.KiiSCNTwitter=function(e){function n(){this._unlinkFromCurrentUser=r(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=r(this._linkWithCurrentUser,this),this._logOut=r(this._logOut,this),this._logIn=r(this._logIn,this),this._unlink=r(this._unlink,this),this._link=r(this._link,this),this._register=r(this._register,this),this._setup=r(this._setup,this),n.__super__.constructor.call(this,KiiSocialNetworkName.TWITTER)}return u(n,e),n.prototype._setup=function(t,e,i){return this._key=t,this._secret=e,this._extras=i,n.__super__._setup.call(this,this._key,this._secret,this._extras)},n.prototype._register=function(e,n){var s,r,o,u=this;return u=this,o=new t("/integration/twitter",!0),o.setMethod("POST"),s={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},o.setData(s),o.setAnonymous(!0),o.setContentType("application/vnd.kii.AuthTokenTwitterRequest+json"),r={success:function(t){var s,r;return u._setToken(e.oauth_token),s={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},u._setTokenObject(s),r=new i.KiiUser,r._updateWithJSON(t),r._setAccessToken(t.access_token),i.Kii.setCurrentUser(r),null!=n?n.success(i.KiiUser.getCurrentUser(),u._network):void 0},failure:function(t){return null!=n?n.failure(null,u._network,t):void 0}},o.execute(r,!1)},n.prototype._link=function(e,n){var s,r,o,u=this;return u=this,o=new t("/users/me/twitter/link",!0),o.setMethod("POST"),s={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},o.setData(s),r={success:function(){var t;return u._setToken(e.oauth_token),t={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},u._setTokenObject(t),null!=n?n.success(i.KiiUser.getCurrentUser(),u._network):void 0},failure:function(t){return null!=n?n.failure(i.KiiUser.getCurrentUser(),u._network,t):void 0}},o.execute(r,!0)},n.prototype._unlink=function(e){var n,s,r=this;return r=this,n=new t("/users/me/twitter/unlink",!0),n.setMethod("POST"),s={success:function(){return r._setToken(null),r._setTokenObject(null),null!=e?e.success(i.KiiUser.getCurrentUser(),r._network):void 0},failure:function(t){return null!=e?e.failure(i.KiiUser.getCurrentUser(),r._network,t):void 0}},n.execute(s,!0)},n.prototype._logIn=function(t,e){if(n.__super__._logIn.call(this,t,e),a=this,i.Kii.logger("Checking options"),i.Kii.logger(t),null==t||!t.oauth_token&&!t.oauth_token_secret)throw i.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!t.oauth_token)throw i.InvalidArgumentException("options.oauth_token is required");if(!t.oauth_token_secret)throw i.InvalidArgumentException("options.oauth_token_secret is required");return null!=i.KiiUser.getCurrentUser()&&i.KiiUser.logOut(),a._register(t,e)},n.prototype._logOut=function(){return n.__super__._logOut.apply(this,arguments),i.Kii.logger("Log out twitter")},n.prototype._linkWithCurrentUser=function(t,e){if(a=this,null==i.KiiUser.getCurrentUser())return e.failure(null,a._network,"No user logged in"),void 0;if(null==t||!t.oauth_token&&!t.oauth_token_secret)throw i.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!t.oauth_token)throw i.InvalidArgumentException("options.oauth_token is required");if(!t.oauth_token_secret)throw i.InvalidArgumentException("options.oauth_token_secret is required");return a._link(t,e)},n.prototype._unlinkFromCurrentUser=function(t){return a=this,null==i.KiiUser.getCurrentUser()?(t.failure(null,a._network,"No user logged in"),void 0):this._unlink(t)},n}(i.KiiSocialConnectNetwork),i.KiiGeoPoint=function(){function t(t,e){var n;if(this._latitude=t,this._longitude=e,this._toDict=r(this._toDict,this),this.getLongitude=r(this.getLongitude,this),this.getLatitude=r(this.getLatitude,this),n=function(t,e,i){return i>t&&e>i&&!isNaN(i)},!n(-90,90,t)||!n(-180,180,e))throw i.InvalidArgumentException("Specified latitide or longitude is invalid")}return t.prototype.getLatitude=function(){return this._latitude},t.prototype.getLongitude=function(){return this._longitude},t.geoPoint=function(t,e){return new i.KiiGeoPoint(t,e)},t.prototype._toDict=function(){var t;return t={_type:"point",lat:this._latitude,lon:this._longitude}},t}.call(this),i};!function(){var e="undefined"!=typeof module&&null!==module;e&&module.exports?module.exports={create:function(){return t.call(this)}}:t()}()}();